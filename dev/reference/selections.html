<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Methods for selecting variables in step functions — selections • recipes</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Methods for selecting variables in step functions — selections"><meta name="description" content="Tips for selecting columns in step functions."><meta property="og:description" content="Tips for selecting columns in step functions."><meta property="og:image" content="https://recipes.tidymodels.org/logo.png"><meta name="robots" content="noindex"><script defer data-domain="recipes.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">recipes</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/recipes.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Dummies.html">Handling categorical predictors</a></li>
    <li><a class="dropdown-item" href="../articles/Selecting_Variables.html">Selecting variables</a></li>
    <li><a class="dropdown-item" href="../articles/Roles.html">Roles in recipes</a></li>
    <li><a class="dropdown-item" href="../articles/Skipping.html">On skipping steps</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/recipes/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Methods for selecting variables in step functions</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/recipes/blob/main/R/selections.R" class="external-link"><code>R/selections.R</code></a></small>
      <div class="d-none name"><code>selections.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Tips for selecting columns in step functions.</p>
    </div>


    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>When selecting variables or model terms in <code>step</code> functions, <code>dplyr</code>-like
tools are used. The <em>selector</em> functions can choose variables based on their
name, current role, data type, or any combination of these. The selectors are
passed as any other argument to the step. If the variables are explicitly
named in the step function, this might look like:</p>
<div class="sourceCode"><pre><code><span></span>
<span>  <span class="fu"><a href="../reference/recipe.html">recipe</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">USArrests</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/step_pca.html">step_pca</a></span><span class="op">(</span><span class="va">Murder</span>, <span class="va">Assault</span>, <span class="va">UrbanPop</span>, <span class="va">Rape</span>, num_comp <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>

<p>The first four arguments indicate which variables should be used in the PCA
while the last argument is a specific argument to <code><a href="step_pca.html">step_pca()</a></code> about the
number of components.</p>
<p>Note that:</p>
<ol><li><p>These arguments are not evaluated until the <code>prep</code> function for the
step is executed.</p></li>
<li><p>The <code>dplyr</code>-like syntax allows for negative signs to exclude
variables (e.g. <code>-Murder</code>) and the set of selectors will processed in
order.</p></li>
<li><p>A leading exclusion in these arguments (e.g. <code>-Murder</code>) has the
effect of adding <em>all</em> variables to the list except the excluded
variable(s), ignoring role information.</p></li>
</ol><p>Select helpers from the <code>tidyselect</code> package can also be used:
<code><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">tidyselect::starts_with()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">tidyselect::ends_with()</a></code>,
<code><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">tidyselect::contains()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">tidyselect::matches()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">tidyselect::num_range()</a></code>,
<code><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">tidyselect::everything()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/one_of.html" class="external-link">tidyselect::one_of()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">tidyselect::all_of()</a></code>,
and <code><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">tidyselect::any_of()</a></code></p>
<p>Note that using <code><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">tidyselect::everything()</a></code> or any of the other <code>tidyselect</code>
functions aren't restricted to predictors. They will thus select outcomes,
ID, and predictor columns alike. This is why these functions should be used
with care, and why <code><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">tidyselect::everything()</a></code> likely isn't what you need.</p>
<p>For example:</p>
<div class="sourceCode"><pre><code><span></span>
<span>  <span class="fu"><a href="../reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/step_center.html">step_center</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"Sepal"</span><span class="op">)</span>, <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"Width"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>

<p>would only select <code>Sepal.Length</code></p>
<p>Columns of the design matrix that may not exist when the step is coded can
also be selected. For example, when using <code><a href="step_pca.html">step_pca()</a></code>, the number of columns
created by feature extraction may not be known when subsequent steps are
defined. In this case, using <code>matches("^PC")</code> will select all of the columns
whose names start with "PC" <em>once those columns are created</em>.</p>
<p>There are sets of recipes-specific functions that can be used to select
variables based on their role or type: <code><a href="has_role.html">has_role()</a></code> and <code><a href="has_role.html">has_type()</a></code>. For
convenience, there are also functions that are more specific. The functions
<code><a href="has_role.html">all_numeric()</a></code> and <code><a href="has_role.html">all_nominal()</a></code> select based on type, with nominal
variables including both character and factor; the functions
<code><a href="has_role.html">all_predictors()</a></code> and <code><a href="has_role.html">all_outcomes()</a></code> select based on role. The functions
<code><a href="has_role.html">all_numeric_predictors()</a></code> and <code><a href="has_role.html">all_nominal_predictors()</a></code> select
intersections of role and type. Any can be used in conjunction with the
previous functions described for selecting variables using their names.</p>
<p>A selection like this:</p>
<div class="sourceCode"><pre><code><span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">biomass</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">HHV</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">biomass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/step_center.html">step_center</a></span><span class="op">(</span><span class="fu"><a href="../reference/has_role.html">all_numeric</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">-</span><span class="fu"><a href="../reference/has_role.html">all_outcomes</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>

<p>is equivalent to:</p>
<div class="sourceCode"><pre><code><span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">biomass</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">HHV</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">biomass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/step_center.html">step_center</a></span><span class="op">(</span><span class="fu"><a href="../reference/has_role.html">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>

<p>Both result in all the numeric predictors: carbon, hydrogen, oxygen,
nitrogen, and sulfur.</p>
<p>If a role for a variable has not been defined, it will never be selected
using role-specific selectors.</p><div class="section">
<h3 id="interactions">Interactions<a class="anchor" aria-label="anchor" href="#interactions"></a></h3>


<p>Selectors can be used in <code><a href="step_interact.html">step_interact()</a></code> in similar ways but must be
embedded in a model formula (as opposed to a sequence of selectors). For
example, the interaction specification could be <code>~ starts_with("Species"):Sepal.Width</code>. This can be useful if <code>Species</code> was
converted to dummy variables previously using <code><a href="step_dummy.html">step_dummy()</a></code>. The
implementation of <code><a href="step_interact.html">step_interact()</a></code> is special, and is more restricted than
the other step functions. Only the selector functions from recipes and
tidyselect are allowed. User defined selector functions will not be
recognized. Additionally, the tidyselect domain specific language is not
recognized here, meaning that <code>&amp;</code>, <code>|</code>, <code>!</code>, and <code>-</code> will not work.</p>
</div>

<div class="section">
<h3 id="tips-for-saving-recipes-and-filtering-columns">Tips for saving recipes and filtering columns<a class="anchor" aria-label="anchor" href="#tips-for-saving-recipes-and-filtering-columns"></a></h3>


<p>When creating variable selections:</p><ul><li><p>If you are using column filtering steps, such as <code><a href="step_corr.html">step_corr()</a></code>, try to
avoid hardcoding specific variable names in downstream steps in case
those columns are removed by the filter. Instead, use
<code><a href="https://dplyr.tidyverse.org/reference/reexports.html" class="external-link">dplyr::any_of()</a></code> and
<code><a href="https://dplyr.tidyverse.org/reference/reexports.html" class="external-link">dplyr::all_of()</a></code>.</p><ul><li><p><code><a href="https://dplyr.tidyverse.org/reference/reexports.html" class="external-link">dplyr::any_of()</a></code> will be tolerant if a column
has been removed.</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/reexports.html" class="external-link">dplyr::all_of()</a></code> will fail unless all of the
columns are present in the data.</p></li>
</ul></li>
<li><p>For both of these functions, if you are going to save the recipe as a
binary object to use in another R session, try to avoid referring to a
vector in your workspace.</p><ul><li><p>Preferred: <code>any_of(!!var_names)</code></p></li>
<li><p>Avoid: <code>any_of(var_names)</code></p></li>
</ul></li>
</ul><p>Some examples:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">some_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># No filter steps, OK for not saving the recipe</span></span>
<span><span class="va">rec_1</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_log.html">step_log</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">some_vars</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/prep.html">prep</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># No filter steps, saving the recipe</span></span>
<span><span class="va">rec_2</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_log.html">step_log</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">some_vars</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/prep.html">prep</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This fails since `wt` is not in the data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span></span>
<span><span class="fu"><a href="../reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_rm.html">step_rm</a></span><span class="op">(</span><span class="va">wt</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_log.html">step_log</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">some_vars</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/prep.html">prep</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Best for filters (using any_of()) and when</span></span>
<span><span class="co"># saving the recipe</span></span>
<span><span class="va">rec_4</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_rm.html">step_rm</a></span><span class="op">(</span><span class="va">wt</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_log.html">step_log</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">some_vars</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># equal to step_log(any_of(c("hp", "drat", "wt")))</span></span>
<span>  <span class="fu"><a href="../reference/prep.html">prep</a></span><span class="op">(</span><span class="op">)</span></span></code></pre><p></p></div>
</div>

    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, Emil Hvitfeldt, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer></body></html>

