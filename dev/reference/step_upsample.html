<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Up-Sample a Data Set Based on a Factor Variable — step_upsample • recipes</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

<!-- Bootstrap -->
<link href="../tidyverse.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>
<link href="../tidyverse-2.css" rel="stylesheet">

<!--optional theme-->
<link href="../tidymodels.css" rel="stylesheet">




<meta property="og:title" content="Up-Sample a Data Set Based on a Factor Variable — step_upsample" />
<meta property="og:description" content="
step_upsample is now available as themis::step_upsample(). This
function creates a specification of a recipe step that
will replicate rows of a data set to make the occurrence of
levels in a specific factor level equal." />
<meta property="og:image" content="https://recipes.tidymodels.org/logo.png" />
<meta name="twitter:card" content="summary" />


<meta name="robots" content="noindex">

<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>

  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">recipes</a>
        <div class="info hidden-xs hidden-sm">
          <span class="partof">part of <a href="https://tidymodels.org">tidymodels</a></span>
          <span class="version version-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.1.15.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../articles/Simple_Example.html">Simple Example</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Selecting_Variables.html">Selecting Variables</a>
    </li>
    <li>
      <a href="../articles/Custom_Steps.html">Custom Steps</a>
    </li>
    <li>
      <a href="../articles/Ordering.html">The Order of Steps</a>
    </li>
    <li>
      <a href="../articles/Dummies.html">Dummy Variables and Interactions</a>
    </li>
    <li>
      <a href="../articles/Roles.html">Column Roles</a>
    </li>
    <li>
      <a href="../articles/Skipping.html">On Skipping Steps</a>
    </li>
    <li>
      <a href="../articles/articles/Subsampling.html">Subsampling for Class Imbalances</a>
    </li>
    <li>
      <a href="../articles/articles/Multivariate_PLS.html">Multivariate Analysis using Partial Least Squares</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
        <li>
  <a href="https://github.com/tidymodels/recipes/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Up-Sample a Data Set Based on a Factor Variable</h1>
    <small class="dont-index">Source: <a href='https://github.com/tidymodels/recipes/blob/master/R/upsample.R'><code>R/upsample.R</code></a></small>
    <div class="hidden name"><code>step_upsample.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><img src='figures/lifecycle-soft-deprecated.svg' alt='alt="lifecycle-soft-deprecated"' /></p>
<p><code>step_upsample</code> is now available as <code>themis::step_upsample()</code>. This
function creates a <em>specification</em> of a recipe step that
will replicate rows of a data set to make the occurrence of
levels in a specific factor level equal.</p>
    </div>

    <pre class="usage"><span class='fu'>step_upsample</span><span class='op'>(</span>
  <span class='va'>recipe</span>,
  <span class='va'>...</span>,
  over_ratio <span class='op'>=</span> <span class='fl'>1</span>,
  ratio <span class='op'>=</span> <span class='cn'>NA</span>,
  role <span class='op'>=</span> <span class='cn'>NA</span>,
  trained <span class='op'>=</span> <span class='cn'>FALSE</span>,
  column <span class='op'>=</span> <span class='cn'>NULL</span>,
  target <span class='op'>=</span> <span class='cn'>NA</span>,
  skip <span class='op'>=</span> <span class='cn'>TRUE</span>,
  seed <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample.int</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>^</span><span class='fl'>5</span>, <span class='fl'>1</span><span class='op'>)</span>,
  id <span class='op'>=</span> <span class='fu'><a href='rand_id.html'>rand_id</a></span><span class='op'>(</span><span class='st'>"upsample"</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='co'># S3 method for step_upsample</span>
<span class='fu'><a href='https://generics.r-lib.org/reference/tidy.html'>tidy</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>recipe</th>
      <td><p>A recipe object. The step will be added to the
sequence of operations for this recipe.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>One or more selector functions to choose which
variable is used to sample the data. See <code><a href='selections.html'>selections()</a></code>
for more details. The selection should result in <em>single
factor variable</em>. For the <code>tidy</code> method, these are not
currently used.</p></td>
    </tr>
    <tr>
      <th>over_ratio</th>
      <td><p>A numeric value for the ratio of the
majority-to-minority frequencies. The default value (1) means
that all other levels are sampled up to have the same
frequency as the most occurring level. A value of 0.5 would mean
that the minority levels will have (at most) (approximately)
half as many rows than the majority level.</p></td>
    </tr>
    <tr>
      <th>ratio</th>
      <td><p>Deprecated argument; same as <code>over_ratio</code>.</p></td>
    </tr>
    <tr>
      <th>role</th>
      <td><p>Not used by this step since no new variables are
created.</p></td>
    </tr>
    <tr>
      <th>trained</th>
      <td><p>A logical to indicate if the quantities for
preprocessing have been estimated.</p></td>
    </tr>
    <tr>
      <th>column</th>
      <td><p>A character string of the variable name that will
be populated (eventually) by the <code>...</code> selectors.</p></td>
    </tr>
    <tr>
      <th>target</th>
      <td><p>An integer that will be used to subsample. This
should not be set by the user and will be populated by <code>prep</code>.</p></td>
    </tr>
    <tr>
      <th>skip</th>
      <td><p>A logical. Should the step be skipped when the
recipe is baked by <code><a href='bake.html'>bake.recipe()</a></code>? While all operations are baked
when <code><a href='prep.html'>prep.recipe()</a></code> is run, some operations may not be able to be
conducted on new data (e.g. processing the outcome variable(s)).
Care should be taken when using <code>skip = TRUE</code> as it may affect
the computations for subsequent operations</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>An integer that will be used as the seed when upsampling.</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>A character string that is unique to this step to identify it.</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>A <code>step_upsample</code> object.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An updated version of <code>recipe</code> with the new step
added to the sequence of existing steps (if any). For the
<code>tidy</code> method, a tibble with columns <code>terms</code> which is
the variable used to sample.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Up-sampling is intended to be performed on the <em>training</em> set alone. For
this reason, the default is <code>skip = TRUE</code>. It is advisable to use
<code><a href='prep.html'>prep(recipe, retain = TRUE)</a></code> when preparing the recipe; in this way
<code><a href='bake.html'>bake(object, new_data = NULL)</a></code> can be used to obtain the up-sampled version
of the data.</p>
<p>If there are missing values in the factor variable that is used
to define the sampling, missing data are selected at random in
the same way that the other factor levels are sampled. Missing
values are not used to determine the amount of data in the
majority level (see example below).</p>
<p>For any data with factor levels occurring with the same
frequency as the majority level, all data will be retained.</p>
<p>All columns in the data are sampled and returned by <code><a href='bake.html'>bake()</a></code>.</p>
<p>When used in modeling, users should strongly consider using the
option <code>skip = TRUE</code> so that the extra sampling is <em>not</em>
conducted outside of the training set.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://modeldata.tidymodels.org'>modeldata</a></span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>okc</span><span class='op'>)</span>

<span class='va'>orig</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>okc</span><span class='op'>$</span><span class='va'>diet</span>, useNA <span class='op'>=</span> <span class='st'>"always"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/sort.html'>sort</a></span><span class='op'>(</span><span class='va'>orig</span>, decreasing <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 
#&gt;                &lt;NA&gt;     mostly anything            anything   strictly anything 
#&gt;               24360               16562                6174                5107 
#&gt;   mostly vegetarian        mostly other strictly vegetarian          vegetarian 
#&gt;                3438                1004                 874                 665 
#&gt;      strictly other        mostly vegan               other      strictly vegan 
#&gt;                 450                 335                 331                 227 
#&gt;               vegan       mostly kosher        mostly halal      strictly halal 
#&gt;                 136                  86                  48                  18 
#&gt;     strictly kosher               halal              kosher 
#&gt;                  18                  11                  11 </div><div class='input'>
<span class='va'>up_rec</span> <span class='op'>&lt;-</span> <span class='fu'><a href='recipe.html'>recipe</a></span><span class='op'>(</span> <span class='op'>~</span> <span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>okc</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='co'># Bring the minority levels up to about 200 each</span>
  <span class='co'># 200/16562 is approx 0.0121</span>
  <span class='fu'>step_upsample</span><span class='op'>(</span><span class='va'>diet</span>, over_ratio <span class='op'>=</span> <span class='fl'>0.0121</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='prep.html'>prep</a></span><span class='op'>(</span>training <span class='op'>=</span> <span class='va'>okc</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='warning'>Warning: `step_upsample()` is deprecated as of recipes 0.1.13.</span>
#&gt; <span class='warning'>Please use `themis::step_upsample()` instead.</span>
#&gt; <span class='warning'><span style='color: #555555;'>This warning is displayed once every 8 hours.</span><span></span>
#&gt; <span class='warning'></span><span style='color: #555555;'>Call `lifecycle::last_warnings()` to see where this warning was generated.</span><span></span></div><div class='input'>
<span class='va'>training</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='fu'><a href='bake.html'>bake</a></span><span class='op'>(</span><span class='va'>up_rec</span>, new_data <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span><span class='op'>$</span><span class='va'>diet</span>, useNA <span class='op'>=</span> <span class='st'>"always"</span><span class='op'>)</span>

<span class='co'># Since `skip` defaults to TRUE, baking the step has no effect</span>
<span class='va'>baked_okc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='bake.html'>bake</a></span><span class='op'>(</span><span class='va'>up_rec</span>, new_data <span class='op'>=</span> <span class='va'>okc</span><span class='op'>)</span>
<span class='va'>baked</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>baked_okc</span><span class='op'>$</span><span class='va'>diet</span>, useNA <span class='op'>=</span> <span class='st'>"always"</span><span class='op'>)</span>

<span class='co'># Note that if the original data contained more rows than the</span>
<span class='co'># target n (= ratio * majority_n), the data are left alone:</span>
<span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
  level <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>orig</span><span class='op'>)</span>,
  orig_freq <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>as.vector</a></span><span class='op'>(</span><span class='va'>orig</span><span class='op'>)</span>,
  train_freq <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>as.vector</a></span><span class='op'>(</span><span class='va'>training</span><span class='op'>)</span>,
  baked_freq <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>as.vector</a></span><span class='op'>(</span><span class='va'>baked</span><span class='op'>)</span>
<span class='op'>)</span>
</div><div class='output co'>#&gt;                  level orig_freq train_freq baked_freq
#&gt; 1             anything      6174       6174       6174
#&gt; 2                halal        11        200         11
#&gt; 3               kosher        11        200         11
#&gt; 4      mostly anything     16562      16562      16562
#&gt; 5         mostly halal        48        200         48
#&gt; 6        mostly kosher        86        200         86
#&gt; 7         mostly other      1004       1004       1004
#&gt; 8         mostly vegan       335        335        335
#&gt; 9    mostly vegetarian      3438       3438       3438
#&gt; 10               other       331        331        331
#&gt; 11   strictly anything      5107       5107       5107
#&gt; 12      strictly halal        18        200         18
#&gt; 13     strictly kosher        18        200         18
#&gt; 14      strictly other       450        450        450
#&gt; 15      strictly vegan       227        227        227
#&gt; 16 strictly vegetarian       874        874        874
#&gt; 17               vegan       136        200        136
#&gt; 18          vegetarian       665        665        665
#&gt; 19                &lt;NA&gt;     24360      24360      24360</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="tidyverse">
  <p>recipes is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Max Kuhn, <a href='http://hadley.nz'>Hadley Wickham</a>.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
   </div>

  


  </body>
</html>


