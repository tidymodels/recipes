<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create a recipe for preprocessing data — recipe • recipes</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a recipe for preprocessing data — recipe"><meta name="description" content="A recipe is a description of the steps to be applied to a data set in order
to prepare it for data analysis."><meta property="og:description" content="A recipe is a description of the steps to be applied to a data set in order
to prepare it for data analysis."><meta property="og:image" content="https://recipes.tidymodels.org/logo.png"><meta name="robots" content="noindex"><script defer data-domain="recipes.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">recipes</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/recipes.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Dummies.html">Handling categorical predictors</a></li>
    <li><a class="dropdown-item" href="../articles/Selecting_Variables.html">Selecting variables</a></li>
    <li><a class="dropdown-item" href="../articles/Roles.html">Roles in recipes</a></li>
    <li><a class="dropdown-item" href="../articles/Skipping.html">On skipping steps</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/recipes/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Create a recipe for preprocessing data</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/recipes/blob/main/R/recipe.R" class="external-link"><code>R/recipe.R</code></a></small>
      <div class="d-none name"><code>recipe.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A recipe is a description of the steps to be applied to a data set in order
to prepare it for data analysis.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">recipe</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">recipe</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'data.frame'</span></span>
<span><span class="fu">recipe</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  formula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  roles <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  strings_as_factors <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'formula'</span></span>
<span><span class="fu">recipe</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'matrix'</span></span>
<span><span class="fu">recipe</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x-data">x, data<a class="anchor" aria-label="anchor" href="#arg-x-data"></a></dt>
<dd><p>A data frame, tibble, or sparse matrix from the <code>Matrix</code>
package of the <em>template</em> data set. See <a href="sparse_data.html">sparse_data</a> for more information
about use of sparse data. (see below).</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Further arguments passed to or from other methods (not currently
used).</p></dd>


<dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>A model formula. No in-line functions should be used here
(e.g. <code>log(x)</code>, <code>x:y</code>, etc.) and minus signs are not allowed. These types
of transformations should be enacted using <code>step</code> functions in this
package. Dots are allowed as are simple multivariate outcome terms (i.e. no
need for <code><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind()</a></code>; see Examples). A model formula may not be the best
choice for high-dimensional data with many columns, because of problems
with memory.</p></dd>


<dt id="arg-vars">vars<a class="anchor" aria-label="anchor" href="#arg-vars"></a></dt>
<dd><p>A character string of column names corresponding to variables
that will be used in any context (see below)</p></dd>


<dt id="arg-roles">roles<a class="anchor" aria-label="anchor" href="#arg-roles"></a></dt>
<dd><p>A character string (the same length of <code>vars</code>) that describes a
single role that the variable will take. This value could be anything but
common roles are <code>"outcome"</code>, <code>"predictor"</code>, <code>"case_weight"</code>, or <code>"ID"</code>.</p></dd>


<dt id="arg-strings-as-factors">strings_as_factors<a class="anchor" aria-label="anchor" href="#arg-strings-as-factors"></a></dt>
<dd><p>A logical, should character columns be converted to
factors? See Details below.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>recipe</code> with sub-objects:</p>
<dl><dt>var_info</dt>
<dd><p>A tibble containing information about the original data set
columns.</p></dd>

<dt>term_info</dt>
<dd><p>A tibble that contains the current set of terms in the
data set. This initially defaults to the same data contained in
<code>var_info</code>.</p></dd>

<dt>steps</dt>
<dd><p>A list of <code>step</code> or <code>check</code> objects that define the sequence
of preprocessing operations that will be applied to data. The default value
is <code>NULL</code>.</p></dd>

<dt>template</dt>
<dd><p>A tibble of the data. This is initialized to be the same as
the data given in the <code>data</code> argument but can be different after the recipe
is trained.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<div class="section">
<h3 id="defining-recipes">Defining recipes<a class="anchor" aria-label="anchor" href="#defining-recipes"></a></h3>


<p>Creating a recipe comes in two parts:</p><ol><li><p>Specifying which variables are used and what roles they should have.</p></li>
<li><p>Specifying what transformations should be applied to which
variables.</p></li>
</ol><p>The first part is done with <code>recipe()</code> and optionally <code><a href="roles.html">update_role()</a></code>,
<code><a href="roles.html">add_role()</a></code>, and <code><a href="roles.html">remove_role()</a></code>. A <code>recipe</code> object can be created in
several ways. If an analysis only contains outcomes and predictors, the
simplest way to create one is to use a formula (e.g. <code>y ~ x1 + x2</code>) that
does not contain inline functions such as <code>log(x3)</code>.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">formula</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Variables in recipes can have any type of <em>role</em>, including outcome,
predictor, observation ID, case weights, stratification variables, etc.
You can instead use the <code>vars</code> and <code>roles</code> argument to specify the
variables and roles. <code>vars</code> must be a character vector of names and
<code>roles</code> must the the corresponding roles.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">data</span>, vars <span class="op">=</span> <span class="va">vars</span>, roles <span class="op">=</span> <span class="va">roles</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Lastly you can use <code><a href="roles.html">update_role()</a></code>, <code><a href="roles.html">add_role()</a></code>, and <code><a href="roles.html">remove_role()</a></code>.
These functions will alter, add, or eliminate roles from the selections.
These can be used in combination with the above ways, or by themselves
since <code>recipe(data)</code> will consume all the data as undeclared roles. Note
that <code><a href="roles.html">update_role()</a></code>, <code><a href="roles.html">add_role()</a></code>, and <code><a href="roles.html">remove_role()</a></code> are applied
before steps and checks, regardless of where they are in the pipeline.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/roles.html">update_role</a></span><span class="op">(</span><span class="va">class</span>, new_role <span class="op">=</span> <span class="st">"outcome"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/roles.html">update_role</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">)</span>, new_role <span class="op">=</span> <span class="st">"predictor"</span><span class="op">)</span></span></code></pre><p></p></div>
<p>There are two different types of operations that can be sequentially
added to a recipe.</p><ul><li><p><strong>Steps</strong> can include operations like scaling a variable, creating
dummy variables or interactions, and so on. More computationally
complex actions such as dimension reduction or imputation can also be
specified.</p></li>
<li><p><strong>Checks</strong> are operations that conduct specific tests of the data.
When the test is satisfied, the data are returned without issue or
modification. Otherwise, an error is thrown.</p></li>
</ul><p>If you have defined a recipe and want to see which steps are included,
use the <code><a href="tidy.recipe.html">tidy()</a></code> method on the recipe object.</p>
<p>Note that the data passed to <code>recipe()</code> need not be the
complete data that will be used to train the steps (by
<code><a href="prep.html">prep()</a></code>). The recipe only needs to know the names and types
of data that will be used. For large data sets, <code><a href="https://rdrr.io/r/utils/head.html" class="external-link">head()</a></code> could
be used to pass a smaller data set to save time and memory.</p>
</div>

<div class="section">
<h3 id="using-recipes">Using recipes<a class="anchor" aria-label="anchor" href="#using-recipes"></a></h3>


<p>Once a recipe is defined, it needs to be <em>estimated</em> before being
applied to data. Most recipe steps have specific quantities that must be
calculated or estimated. For example,
<code><a href="step_normalize.html">step_normalize()</a></code> needs to compute the training
set’s mean for the selected columns, while
<code><a href="step_dummy.html">step_dummy()</a></code> needs to determine the factor levels of
selected columns in order to make the appropriate indicator columns.</p>
<p>The two most common application of recipes are modeling and stand-alone
preprocessing. How the recipe is estimated depends on how it is being
used.</p><div class="section">
<h4 id="modeling">Modeling<a class="anchor" aria-label="anchor" href="#modeling"></a></h4>


<p>The best way to use use a recipe for modeling is via the <code>workflows</code>
package. This bundles a model and preprocessor (e.g. a recipe) together
and gives the user a fluent way to train the model/recipe and make
predictions.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/workflows" class="external-link">workflows</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/recipes" class="external-link">recipes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/parsnip" class="external-link">parsnip</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">biomass</span>, package <span class="op">=</span> <span class="st">"modeldata"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># split data</span></span>
<span><span class="va">biomass_tr</span> <span class="op">&lt;-</span> <span class="va">biomass</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dataset</span> <span class="op">==</span> <span class="st">"Training"</span><span class="op">)</span></span>
<span><span class="va">biomass_te</span> <span class="op">&lt;-</span> <span class="va">biomass</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dataset</span> <span class="op">==</span> <span class="st">"Testing"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># With only predictors and outcomes, use a formula:</span></span>
<span><span class="va">rec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">HHV</span> <span class="op">~</span> <span class="va">carbon</span> <span class="op">+</span> <span class="va">hydrogen</span> <span class="op">+</span> <span class="va">oxygen</span> <span class="op">+</span> <span class="va">nitrogen</span> <span class="op">+</span> <span class="va">sulfur</span>,</span>
<span>              data <span class="op">=</span> <span class="va">biomass_tr</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now add preprocessing steps to the recipe:</span></span>
<span><span class="va">sp_signed</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">rec</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_normalize.html">step_normalize</a></span><span class="op">(</span><span class="fu"><a href="../reference/has_role.html">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_spatialsign.html">step_spatialsign</a></span><span class="op">(</span><span class="fu"><a href="../reference/has_role.html">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sp_signed</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">## -- Recipe ------------------------------------------------------------</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">## -- Inputs</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">## Number of variables by role</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="do">## outcome:   1</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="do">## predictor: 5</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="do">## -- Operations</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="do">## * Centering and scaling for: all_numeric_predictors()</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="do">## * Spatial sign on: all_numeric_predictors()</span></span></code></pre><p></p></div>
<p>We can create a <code>parsnip</code> model, and then build a workflow with the
model and recipe:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">linear_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/linear_reg.html" class="external-link">linear_reg</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">linear_sp_sign_wflow</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://workflows.tidymodels.org/reference/workflow.html" class="external-link">workflow</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://workflows.tidymodels.org/reference/add_model.html" class="external-link">add_model</a></span><span class="op">(</span><span class="va">linear_mod</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://workflows.tidymodels.org/reference/add_recipe.html" class="external-link">add_recipe</a></span><span class="op">(</span><span class="va">sp_signed</span><span class="op">)</span></span>
<span></span>
<span><span class="va">linear_sp_sign_wflow</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">## == Workflow ==========================================================</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">## Preprocessor: Recipe</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">## Model: linear_reg()</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">## -- Preprocessor ------------------------------------------------------</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">## 2 Recipe Steps</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">## * step_normalize()</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">## * step_spatialsign()</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="do">## -- Model -------------------------------------------------------------</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="do">## Linear Regression Model Specification (regression)</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="do">## Computational engine: lm</span></span></code></pre><p></p></div>
<p>To estimate the preprocessing steps and then fit the linear model, a
single call to <code><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit()</a></code> is used:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">linear_sp_sign_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">linear_sp_sign_wflow</span>, data <span class="op">=</span> <span class="va">biomass_tr</span><span class="op">)</span></span></code></pre><p></p></div>
<p>When predicting, there is no need to do anything other than call
<code><a href="https://parsnip.tidymodels.org/reference/predict.model_fit.html" class="external-link">predict()</a></code>. This preprocesses the new
data in the same manner as the training set, then gives the data to the
linear model prediction code:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">linear_sp_sign_fit</span>, new_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">biomass_te</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">## # A tibble: 6 x 1</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">##   .pred</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">##   &lt;dbl&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">## 1  18.1</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">## 2  17.9</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">## 3  17.2</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">## 4  18.8</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">## 5  19.6</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">## 6  14.6</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h4 id="stand-alone-use-of-recipes">Stand-alone use of recipes<a class="anchor" aria-label="anchor" href="#stand-alone-use-of-recipes"></a></h4>


<p>When using a recipe to generate data for a visualization or to
troubleshoot any problems with the recipe, there are functions that can
be used to estimate the recipe and apply it to new data manually.</p>
<p>Once a recipe has been defined, the <code><a href="prep.html">prep()</a></code> function can be
used to estimate quantities required for the operations using a data set
(a.k.a. the training data). <code><a href="prep.html">prep()</a></code> returns a recipe.</p>
<p>As an example of using PCA (perhaps to produce a plot):</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="co"># Define the recipe</span></span>
<span><span class="va">pca_rec</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">rec</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_normalize.html">step_normalize</a></span><span class="op">(</span><span class="fu"><a href="../reference/has_role.html">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_pca.html">step_pca</a></span><span class="op">(</span><span class="fu"><a href="../reference/has_role.html">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Now to estimate the normalization statistics and the PCA loadings:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">pca_rec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prep.html">prep</a></span><span class="op">(</span><span class="va">pca_rec</span>, training <span class="op">=</span> <span class="va">biomass_tr</span><span class="op">)</span></span>
<span><span class="va">pca_rec</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">## -- Recipe ------------------------------------------------------------</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">## -- Inputs</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">## Number of variables by role</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="do">## outcome:   1</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="do">## predictor: 5</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="do">## -- Training information</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="do">## Training data contained 456 data points and no incomplete rows.</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="do">## -- Operations</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="do">## * Centering and scaling for: carbon hydrogen, ... | Trained</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a><span class="do">## * PCA extraction with: carbon, hydrogen, oxygen, ... | Trained</span></span></code></pre><p></p></div>
<p>Note that the estimated recipe shows the actual column names captured by
the selectors.</p>
<p>You can <code><a href="tidy.recipe.html">tidy.recipe()</a></code> a recipe, either when it is
prepped or unprepped, to learn more about its components.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">pca_rec</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">## # A tibble: 2 x 6</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">##   number operation type      trained skip  id</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">##    &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;lgl&gt;   &lt;lgl&gt; &lt;chr&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">## 1      1 step      normalize TRUE    FALSE normalize_AeYA4</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">## 2      2 step      pca       TRUE    FALSE pca_Zn1yz</span></span></code></pre><p></p></div>
<p>You can also <code><a href="tidy.recipe.html">tidy()</a></code> recipe <em>steps</em> with a <code>number</code>
or <code>id</code> argument.</p>
<p>To apply the prepped recipe to a data set, the <code><a href="bake.html">bake()</a></code>
function is used in the same manner that
<code><a href="https://parsnip.tidymodels.org/reference/predict.model_fit.html" class="external-link">predict()</a></code> would be for models. This
applies the estimated steps to any data set.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/bake.html">bake</a></span><span class="op">(</span><span class="va">pca_rec</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">biomass_te</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">## # A tibble: 6 x 6</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">##     HHV    PC1    PC2     PC3     PC4     PC5</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">##   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">## 1  18.3 0.730  -0.412 -0.495   0.333   0.253</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">## 2  17.6 0.617   1.41   0.118  -0.466   0.815</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">## 3  17.2 0.761   1.10  -0.0550 -0.397   0.747</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">## 4  18.9 0.0400  0.950  0.158   0.405  -0.143</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">## 5  20.5 0.792  -0.732  0.204   0.465  -0.148</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">## 6  18.5 0.433  -0.127 -0.354  -0.0168 -0.0888</span></span></code></pre><p></p></div>
<p>In general, the workflow interface to recipes is recommended for most
applications.</p>
</div>


</div>

<div class="section">
<h3 id="strings-and-factors">Strings and Factors<a class="anchor" aria-label="anchor" href="#strings-and-factors"></a></h3>


<p>The primary purpose of a recipe is to facilitate visualization,
modeling, and analysis. Because of this, most qualitative data should be
encoded as factors instead of character strings (with exceptions for
text analysis and related tasks). It is preferred that quantitative data
be converted to factors prior to passing the data to the recipe since
the number of levels is usually required for steps (e.g., for making
dummy indicator columns).</p>
<p>Although it is advisable to create factors before calling
<code>recipe()</code>, that function has a <code>strings_as_factors</code>
argument that can do the conversion. This affects the preprocessed
training set (when <code>retain = TRUE</code>) as well as the results of both
<code><a href="prep.html">prep.recipe()</a></code> and <code><a href="bake.html">bake.recipe()</a></code>.
This will only affect variables with roles <code>"outcome"</code> and <code>"predictor"</code></p>
<p>In 1.2.1 and prior versions of the recipes package, this argument was
provided via <code><a href="prep.html">prep()</a></code>. Code that only provides it via
<code><a href="prep.html">prep()</a></code> will continue to work with a once-per-session
warning, and in a future version, it will become an error. If provided
in both <code><a href="prep.html">prep()</a></code> and <code>recipe()</code>, the value in
<code>recipe()</code> will take precedence. Default to <code>NULL,</code> which
will be taken as <code>TRUE</code>.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="prep.html">prep()</a></code> and <code><a href="bake.html">bake()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># formula example with single outcome:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">biomass</span>, package <span class="op">=</span> <span class="st">"modeldata"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># split data</span></span></span>
<span class="r-in"><span><span class="va">biomass_tr</span> <span class="op">&lt;-</span> <span class="va">biomass</span><span class="op">[</span><span class="va">biomass</span><span class="op">$</span><span class="va">dataset</span> <span class="op">==</span> <span class="st">"Training"</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">biomass_te</span> <span class="op">&lt;-</span> <span class="va">biomass</span><span class="op">[</span><span class="va">biomass</span><span class="op">$</span><span class="va">dataset</span> <span class="op">==</span> <span class="st">"Testing"</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With only predictors and outcomes, use a formula</span></span></span>
<span class="r-in"><span><span class="va">rec</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">HHV</span> <span class="op">~</span> <span class="va">carbon</span> <span class="op">+</span> <span class="va">hydrogen</span> <span class="op">+</span> <span class="va">oxygen</span> <span class="op">+</span> <span class="va">nitrogen</span> <span class="op">+</span> <span class="va">sulfur</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">biomass_tr</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now add preprocessing steps to the recipe</span></span></span>
<span class="r-in"><span><span class="va">sp_signed</span> <span class="op">&lt;-</span> <span class="va">rec</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="step_normalize.html">step_normalize</a></span><span class="op">(</span><span class="fu"><a href="has_role.html">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="step_spatialsign.html">step_spatialsign</a></span><span class="op">(</span><span class="fu"><a href="has_role.html">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sp_signed</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Recipe</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Inputs </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of variables by role</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> outcome:   1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> predictor: 5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Operations </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Centering and scaling for: <span style="color: #0000BB;">all_numeric_predictors()</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Spatial sign on: <span style="color: #0000BB;">all_numeric_predictors()</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># formula multivariate example:</span></span></span>
<span class="r-in"><span><span class="co"># no need for `cbind(carbon, hydrogen)` for left-hand side</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">multi_y</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span><span class="va">carbon</span> <span class="op">+</span> <span class="va">hydrogen</span> <span class="op">~</span> <span class="va">oxygen</span> <span class="op">+</span> <span class="va">nitrogen</span> <span class="op">+</span> <span class="va">sulfur</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">biomass_tr</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">multi_y</span> <span class="op">&lt;-</span> <span class="va">multi_y</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="step_center.html">step_center</a></span><span class="op">(</span><span class="fu"><a href="has_role.html">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="step_scale.html">step_scale</a></span><span class="op">(</span><span class="fu"><a href="has_role.html">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># example using `update_role` instead of formula:</span></span></span>
<span class="r-in"><span><span class="co"># best choice for high-dimensional data</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rec</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span><span class="va">biomass_tr</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="roles.html">update_role</a></span><span class="op">(</span><span class="va">carbon</span>, <span class="va">hydrogen</span>, <span class="va">oxygen</span>, <span class="va">nitrogen</span>, <span class="va">sulfur</span>,</span></span>
<span class="r-in"><span>    new_role <span class="op">=</span> <span class="st">"predictor"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="roles.html">update_role</a></span><span class="op">(</span><span class="va">HHV</span>, new_role <span class="op">=</span> <span class="st">"outcome"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="roles.html">update_role</a></span><span class="op">(</span><span class="va">sample</span>, new_role <span class="op">=</span> <span class="st">"id variable"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="roles.html">update_role</a></span><span class="op">(</span><span class="va">dataset</span>, new_role <span class="op">=</span> <span class="st">"splitting indicator"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rec</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Recipe</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Inputs </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of variables by role</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> outcome:             1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> predictor:           5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> id variable:         1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> splitting indicator: 1</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, Emil Hvitfeldt, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer></body></html>

