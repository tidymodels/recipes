<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Developer functions for creating recipes steps — developer_functions • recipes</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Developer functions for creating recipes steps — developer_functions"><meta name="description" content="This page provides a comprehensive list of the exported functions for
creating recipes steps and guidance on how to use them."><meta property="og:description" content="This page provides a comprehensive list of the exported functions for
creating recipes steps and guidance on how to use them."><meta property="og:image" content="https://recipes.tidymodels.org/logo.png"><meta name="robots" content="noindex"><script defer data-domain="recipes.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">recipes</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/recipes.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Dummies.html">Handling categorical predictors</a></li>
    <li><a class="dropdown-item" href="../articles/Selecting_Variables.html">Selecting variables</a></li>
    <li><a class="dropdown-item" href="../articles/Roles.html">Roles in recipes</a></li>
    <li><a class="dropdown-item" href="../articles/Skipping.html">On skipping steps</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/recipes/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Developer functions for creating recipes steps</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/recipes/blob/main/R/developer.R" class="external-link"><code>R/developer.R</code></a></small>
      <div class="d-none name"><code>developer_functions.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This page provides a comprehensive list of the exported functions for
creating recipes steps and guidance on how to use them.</p>
    </div>


    <div class="section level2">
    <h2 id="creating-steps">Creating steps<a class="anchor" aria-label="anchor" href="#creating-steps"></a></h2>
    <p><code><a href="add_step.html">add_step()</a></code> and <code><a href="add_step.html">add_check()</a></code> are required when creating a new step. The
output of <code><a href="add_step.html">add_step()</a></code> should be the return value of all steps and should
have the following format:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">step_example</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">recipe</span>,</span>
<span>                         <span class="va">...</span>,</span>
<span>                         <span class="va">role</span> <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                         <span class="va">trained</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                         <span class="va">skip</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                         <span class="va">id</span> <span class="op">=</span> <span class="fu"><a href="../reference/rand_id.html">rand_id</a></span><span class="op">(</span><span class="st">"example"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/add_step.html">add_step</a></span><span class="op">(</span></span>
<span>    <span class="va">recipe</span>,</span>
<span>    <span class="fu">step_example_new</span><span class="op">(</span></span>
<span>      terms <span class="op">=</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/enquo.html" class="external-link">enquos</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>,</span>
<span>      role <span class="op">=</span> <span class="va">role</span>,</span>
<span>      trained <span class="op">=</span> <span class="va">trained</span>,</span>
<span>      skip <span class="op">=</span> <span class="va">skip</span>,</span>
<span>      id <span class="op">=</span> <span class="va">id</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre><p></p></div>
<p><code><a href="rand_id.html">rand_id()</a></code> should be used in the arguments of <code>step_example()</code> to specify
the argument, as we see in the above example.</p>
<p><code><a href="recipes_pkg_check.html">recipes_pkg_check()</a></code> should be used in <code>step_example()</code> functions together
with <code><a href="https://generics.r-lib.org/reference/required_pkgs.html" class="external-link">required_pkgs()</a></code> to alert users that certain other packages are
required. The standard way of using this function is the following format:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/recipes_pkg_check.html">recipes_pkg_check</a></span><span class="op">(</span><span class="fu">required_pkgs.step_example</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
<p><code><a href="step.html">step()</a></code> and <code><a href="step.html">check()</a></code> are used within the <code>step_*_new()</code> function that you
use in your new step. It will be used in the following way:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">step_example_new</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">terms</span>, <span class="va">role</span>, <span class="va">trained</span>, <span class="va">skip</span>, <span class="va">id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/step.html">step</a></span><span class="op">(</span></span>
<span>    subclass <span class="op">=</span> <span class="st">"example"</span>,</span>
<span>    terms <span class="op">=</span> <span class="va">terms</span>,</span>
<span>    role <span class="op">=</span> <span class="va">role</span>,</span>
<span>    trained <span class="op">=</span> <span class="va">trained</span>,</span>
<span>    skip <span class="op">=</span> <span class="va">skip</span>,</span>
<span>    id <span class="op">=</span> <span class="va">id</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre><p></p></div>
<p><code><a href="recipes_eval_select.html">recipes_eval_select()</a></code> is used within <code>prep.step_*()</code> functions, and are
used to turn the <code>terms</code> object into a character vector of the selected
variables.</p>
<p>It will most likely be used like so:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">col_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recipes_eval_select.html">recipes_eval_select</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">terms</span>, <span class="va">training</span>, <span class="va">info</span><span class="op">)</span></span></code></pre><p></p></div>
<p><code><a href="recipes_argument_select.html">recipes_argument_select()</a></code> is used within <code>prep.step_*()</code> functions in the
same way as <code><a href="recipes_eval_select.html">recipes_eval_select()</a></code> but is intended to be used for arguments
such as <code>denom</code> in <code><a href="step_ratio.html">step_ratio()</a></code>.</p>
<p>It will most likely be used like so:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">outcome_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recipes_argument_select.html">recipes_argument_select</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">outcome</span>, <span class="va">training</span>, <span class="va">info</span><span class="op">)</span></span></code></pre><p></p></div>
<p><code><a href="check_type.html">check_type()</a></code> can be used within <code>prep.step_*()</code> functions to check that the
variables passed in are the right types. We recommend that you use the
<code>types</code> argument as it offers higher flexibility and it matches the types
defined by <code><a href="get_data_types.html">.get_data_types()</a></code>. When using <code>types</code> we find it better to be
explicit, e.g. writing <code>types = c("double", "integer")</code> instead of <code>types = "numeric"</code>, as it produces cleaner error messages.</p>
<p>It should be used like so:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/check_type.html">check_type</a></span><span class="op">(</span><span class="va">training</span><span class="op">[</span>, <span class="va">col_names</span><span class="op">]</span>, types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"double"</span>, <span class="st">"integer"</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
<p><code><a href="check_options.html">check_options()</a></code> can be used within <code>prep.step_*()</code> functions to check that
the <code>options</code> argument contains the right elements. It doens't check the
types of the elements, just that <code>options</code> is a named list and it includes
or excludes some names.</p>
<p>It should be used like so:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="co"># When you know some arguments are excluded</span></span>
<span><span class="fu"><a href="../reference/check_options.html">check_options</a></span><span class="op">(</span><span class="va">xoptions</span>, exclude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"pattern"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># When you know all legal elements</span></span>
<span><span class="fu"><a href="../reference/check_options.html">check_options</a></span><span class="op">(</span><span class="va">xoptions</span>, include <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nthread"</span>, <span class="st">"eps"</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
<p><code><a href="check_new_data.html">check_new_data()</a></code> should be used within <code>bake.step_*()</code>. This function is
used to make check that the required columns are present in the data. It
should be one of the first lines inside the function.</p>
<p>It should be used like so:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/check_new_data.html">check_new_data</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">object</span><span class="op">$</span><span class="va">columns</span><span class="op">)</span>, <span class="va">object</span>, <span class="va">new_data</span><span class="op">)</span></span></code></pre><p></p></div>
<p><code><a href="check_name.html">check_name()</a></code> should be used in <code>bake.step_*()</code> functions for steps that add
new columns to the data set. The function throws an error if the column names
already exist in the data set. It should be called before adding the new
columns to the data set.</p>
<p><code><a href="get_keep_original_cols.html">get_keep_original_cols()</a></code> and <code><a href="remove_original_cols.html">remove_original_cols()</a></code> are used within steps
with the <code>keep_original_cols</code> argument. <code><a href="get_keep_original_cols.html">get_keep_original_cols()</a></code> is used in
<code>prep.step_*()</code> functions for steps that were created before the
<code>keep_original_cols</code> argument was added, and acts as a way to throw a warning
that the user should regenerate the recipe. <code><a href="remove_original_cols.html">remove_original_cols()</a></code> should
be used in <code>bake.step_*()</code> functions to remove the original columns. It is
worth noting that <code><a href="remove_original_cols.html">remove_original_cols()</a></code> can remove multiple columns at
once and when possible should be put outside <code>for</code> loops.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">new_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/remove_original_cols.html">remove_original_cols</a></span><span class="op">(</span><span class="va">new_data</span>, <span class="va">object</span>, <span class="va">names_of_original_cols</span><span class="op">)</span></span></code></pre><p></p></div>
<p><code><a href="recipes_remove_cols.html">recipes_remove_cols()</a></code> should be used in <code>prep.step_*()</code> functions, and is
used to remove columns from the data set, either by using the
<code>object$removals</code> field or by using the <code>col_names</code> argument.</p>
<p><code><a href="recipes-role-indicator.html">recipes_names_predictors()</a></code> and <code><a href="recipes-role-indicator.html">recipes_names_outcomes()</a></code> should be used in
<code>prep.step_*()</code> functions, and are used to get names of predictors and
outcomes.</p>
<p><code><a href="case-weight-helpers.html">get_case_weights()</a></code> and <code><a href="case-weight-helpers.html">are_weights_used()</a></code> are functions that help you
extract case weights and help determine if they are used or not within the
step. They will typically be used within the <code>prep.step_*()</code> functions if the
step in question supports case weights.</p>
<p><code><a href="recipes-internal.html">print_step()</a></code> is used inside <code>print.step_*()</code> functions. This function is
replacing the internally deprecated <code><a href="recipes-internal.html">printer()</a></code> function.</p>
<p><code><a href="recipes-internal.html">sel2char()</a></code> is mostly used within <code>tidy.step_*()</code> functions to turn
selections into character vectors.</p>
<p><code><a href="names0.html">names0()</a></code> creates a series of <code>num</code> names with a common prefix. The names
are numbered with leading zeros (e.g. <code>prefix01</code>-<code>prefix10</code> instead of
<code>prefix1</code>-<code>prefix10</code>). This is useful for many types of steps that produce
new columns.</p>
    </div>
    <div class="section level2">
    <h2 id="interacting-with-recipe-objects">Interacting with recipe objects<a class="anchor" aria-label="anchor" href="#interacting-with-recipe-objects"></a></h2>
    <p><code><a href="recipes_ptype.html">recipes_ptype()</a></code> returns the ptype, expected variables and types, that a
recipe object expects at <code><a href="prep.html">prep()</a></code> and <code><a href="bake.html">bake()</a></code> time. Controlled using the
<code>stage</code> argument. Can be used by functions that interact with recipes to
verify data is correct before passing it to <code><a href="prep.html">prep()</a></code> and <code><a href="bake.html">bake()</a></code>.</p>
<p><code><a href="recipes_ptype_validate.html">recipes_ptype_validate()</a></code> checks that a recipe and its data are compatible
using information extracted using <code><a href="recipes_ptype.html">recipes_ptype()</a></code>. Can be used by functions
that interact with recipes to verify data is correct before passing it to
<code><a href="prep.html">prep()</a></code> and <code><a href="bake.html">bake()</a></code>.</p>
<p><code><a href="detect_step.html">detect_step()</a></code> returns a logical indicator to determine if a given step or
check is included in a recipe.</p>
<p><code><a href="fully_trained.html">fully_trained()</a></code> returns a logical indicator if the recipe is fully trained.
The function <code><a href="recipes-internal.html">is_trained()</a></code> can be used to check in any individual steps are
trained or not.</p>
<p><code><a href="get_data_types.html">.get_data_types()</a></code> is an S3 method that is used for <a href="selections.html">selections</a>. This method
can be extended to work with column types not supported by recipes.</p>
<p><code><a href="recipes_extension_check.html">recipes_extension_check()</a></code> is recommended to be used by package authors to
make sure that all steps have <code>prep.step_*()</code>, <code>bake.step_*()</code>,
<code>print.step_*()</code>, <code>tidy.step_*()</code>, and <code>required_pkgs.step_*()</code> methods. It
should be used as a test, preferably like this:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">test_that</span><span class="op">(</span><span class="st">"recipes_extension_check"</span>, <span class="op">{</span></span>
<span>  <span class="fu">expect_snapshot</span><span class="op">(</span></span>
<span>    <span class="fu">recipes</span><span class="fu">::</span><span class="fu"><a href="../reference/recipes_extension_check.html">recipes_extension_check</a></span><span class="op">(</span></span>
<span>      pkg <span class="op">=</span> <span class="st">"pkgname"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre><p></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, Emil Hvitfeldt, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer></body></html>

