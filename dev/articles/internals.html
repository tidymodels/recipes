<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Recipes Internals • recipes</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Recipes Internals">
<meta name="description" content="Overview and explanation of recipe object internals.">
<meta property="og:description" content="Overview and explanation of recipe object internals.">
<meta property="og:image" content="https://recipes.tidymodels.org/logo.png">
<meta name="robots" content="noindex">
<script defer data-domain="recipes.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">recipes</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/recipes.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Dummies.html">Handling categorical predictors</a></li>
    <li><a class="dropdown-item" href="../articles/Selecting_Variables.html">Selecting variables</a></li>
    <li><a class="dropdown-item" href="../articles/Roles.html">Roles in recipes</a></li>
    <li><a class="dropdown-item" href="../articles/Skipping.html">On skipping steps</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/recipes/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Recipes Internals</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/recipes/blob/main/vignettes/articles/internals.Rmd" class="external-link"><code>vignettes/articles/internals.Rmd</code></a></small>
      <div class="d-none name"><code>internals.Rmd</code></div>
    </div>

    
    
<p>These elements should not be accessed by users directly. They should
instead be accessed via helper functions.</p>
<p>The <code>recipe</code> object will contain different elements
depending on whether it has been <code><a href="../reference/prep.html">prep()</a></code>ed or not. We will
list all of them here and what they contain.</p>
<p>An unprepped recipe will contain:</p>
<ul>
<li>var_info</li>
<li>term_info</li>
<li>steps</li>
<li>template</li>
<li>levels</li>
<li>retained</li>
<li>requirements</li>
<li>ptype</li>
<li>strings_as_factors</li>
</ul>
<p>A prepped recipe will contain:</p>
<ul>
<li>var_info</li>
<li>term_info</li>
<li>steps</li>
<li>template</li>
<li>retained</li>
<li>requirements</li>
<li>ptype</li>
<li>strings_as_factors</li>
<li>tr_info</li>
<li>orig_lvls</li>
<li>fit_times</li>
<li>last_term_info</li>
</ul>
<div class="section level2">
<h2 id="var_info">var_info<a class="anchor" aria-label="anchor" href="#var_info"></a>
</h2>
<p><em>Appears in both unprepped and prepped recipes</em></p>
<p>A tibble containing information about the original data set columns.
It will contain the 4 columns <code>variable</code>, <code>type</code>,
<code>role</code>, and <code>source</code>.</p>
<ul>
<li>
<code>variable</code> is a character vector of variable names.</li>
<li>
<code>type</code> is a list column of character variables. These
character vectors are used in type selection functions such as
<code><a href="../reference/has_role.html">all_numeric()</a></code> and <code><a href="../reference/has_role.html">all_integer()</a></code>. Each variable
has one or more character values to allow for granular selections. An
integer variable will have <code>type</code> values
<code>c("integer", "numeric")</code> allowing it to be selected by
<code><a href="../reference/has_role.html">all_numeric()</a></code> and <code><a href="../reference/has_role.html">all_integer()</a></code> but not
<code>all_doubles()</code>.</li>
<li>
<code>role</code> is a character vector of roles.</li>
<li>
<code>source</code> is a character vector. It can contain 2 values
<code>"original"</code> and <code>"derived"</code>.
<code>"derived"</code> is used to denote variables that are created by
steps such as those created by <code><a href="../reference/step_dummy.html">step_dummy()</a></code> and
<code><a href="../reference/step_pca.html">step_pca()</a></code>.</li>
</ul>
<p>Note that there can be duplicates of <code>variable</code> as each
variable can have multiple roles as denoted by <code>role</code>.</p>
<p>The <code>source</code> element for unprepped recipes should be
<code>"original"</code> for all variables. This is kept here for parity
with <code>term_info</code>.</p>
</div>
<div class="section level2">
<h2 id="term_info">term_info<a class="anchor" aria-label="anchor" href="#term_info"></a>
</h2>
<p><em>Appears in both unprepped and prepped recipes</em></p>
<p>A tibble that contains the current set of terms in the data set. This
initially defaults to the same data contained in <code>var_info</code>.
This is updated after each step is <code><a href="../reference/prep.html">prep()</a></code>ed. It should
contain the state of the variables you would see after
<code><a href="../reference/bake.html">bake()</a></code>ing a recipe.</p>
<p>The format is the same as described in <code>var_info</code>.</p>
</div>
<div class="section level2">
<h2 id="steps">steps<a class="anchor" aria-label="anchor" href="#steps"></a>
</h2>
<p><em>Appears in both unprepped and prepped recipes</em></p>
<p>A list of <code>step</code> or <code>check</code> objects that define
the sequence of preprocessing operations that will be applied to data.
The default value is <code>NULL</code>.</p>
<p>The content of each element will depend on each <code>step</code> or
<code>check</code> object.</p>
</div>
<div class="section level2">
<h2 id="template">template<a class="anchor" aria-label="anchor" href="#template"></a>
</h2>
<p><em>Appears in both unprepped and prepped recipes</em></p>
<p>A tibble of the data is passed to <code><a href="../reference/recipe.html">recipe()</a></code>. This is
initialized to be the same as the data given in the <code>data</code>
argument but can be different after the recipe is trained. If
<code>retain = TRUE</code> is set when <code><a href="../reference/prep.html">prep()</a></code>ing then the
<code>template</code> dataset will contain the data after it has been
processed by the recipe. <code>retain = TRUE</code> is the default.</p>
</div>
<div class="section level2">
<h2 id="levels">levels<a class="anchor" aria-label="anchor" href="#levels"></a>
</h2>
<p><em>May appear in both unprepped and prepped recipes</em></p>
<p>When a recipe is unprepped this element will be <code>NULL</code>.
When it has been prepped it will either not be present or not. If at
least one of the variables in the <code>template</code> has factor
levels. Otherwise, it will be missing, not <code>NULL</code>. If the
element is there it will be a named list, with the names matching those
in <code>template</code>. Each element will contain the elements
<code>values</code> and <code>ordered</code>, with some also including
<code>factor</code>. The <code>factor</code> element will only appear
for variables that are factors, unordered or ordered.</p>
<ul>
<li>
<code>values</code> A character vector of factor levels if the
variable is a factor, <code>NA</code> otherwise.</li>
<li>
<code>ordered</code> A logical value, <code>TRUE</code> if the
variable is an ordered factor, <code>FALSE</code> if the variable is an
unordered factor, <code>NA</code> otherwise.</li>
<li>
<code>factor</code> A logical value, appears to always be
<code>TRUE</code>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="retained">retained<a class="anchor" aria-label="anchor" href="#retained"></a>
</h2>
<p><em>Appears in both unprepped and prepped recipes</em></p>
<p>A logical value. Will be <code>NA</code> for unprepped recipes.
Otherwise will depend on what value was passed to <code>retain</code> in
<code><a href="../reference/prep.html">prep()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="requirements">requirements<a class="anchor" aria-label="anchor" href="#requirements"></a>
</h2>
<p><em>Appears in both unprepped and prepped recipes</em></p>
<p>A named list. This will be an empty list unless
<code><a href="../reference/update_role_requirements.html">update_role_requirements()</a></code> is used. If
<code><a href="../reference/update_role_requirements.html">update_role_requirements()</a></code> has been used it will gain an
element named <code><a href="../reference/bake.html">bake()</a></code> which will contain a named logical
vector. The names correspond to the roles that have updated
requirements, and the value itself is whether the role is required at
<code><a href="../reference/bake.html">bake()</a></code> time.</p>
</div>
<div class="section level2">
<h2 id="ptype">ptype<a class="anchor" aria-label="anchor" href="#ptype"></a>
</h2>
<p><em>Appears in both unprepped and prepped recipes</em></p>
<p>A zero-row slice of the data set is passed to <code><a href="../reference/recipe.html">recipe()</a></code>.
This data set is used with <code><a href="../reference/recipes_ptype.html">recipes_ptype()</a></code> and
<code><a href="../reference/recipes_ptype_validate.html">recipes_ptype_validate()</a></code> to make sure the recipe takes on
the same shape of data when specified as when prepped and baked.</p>
</div>
<div class="section level2">
<h2 id="strings_as_factors">strings_as_factors<a class="anchor" aria-label="anchor" href="#strings_as_factors"></a>
</h2>
<p><em>Appears in both unprepped and prepped recipes</em></p>
<p>A single logical. Whether strings should be converted to factors in
<code><a href="../reference/prep.html">prep()</a></code>. Defaults to <code>TRUE</code>.</p>
</div>
<div class="section level2">
<h2 id="tr_info">tr_info<a class="anchor" aria-label="anchor" href="#tr_info"></a>
</h2>
<p><em>Appears only in prepped recipes</em></p>
<p>A data.frame with 1 row and 2 variables <code>nrows</code> and
<code>ncomplete</code>.</p>
<ul>
<li>
<code>nrows</code> is an integer, the number of rows in the training
data set used in <code><a href="../reference/prep.html">prep()</a></code>.</li>
<li>
<code>ncomplete</code> is an integer, the number of rows that don’t
contain any missing values in the data that was passed to
<code><a href="../reference/prep.html">prep()</a></code>.</li>
</ul>
<p>Note that <code>ncomplete</code> represents the counts before any of
the steps are applied. <code>tr_info</code> is used for the print method
for the recipe itself.</p>
</div>
<div class="section level2">
<h2 id="orig_lvls">orig_lvls<a class="anchor" aria-label="anchor" href="#orig_lvls"></a>
</h2>
<p><em>Appears only in prepped recipes</em></p>
<p>This element is highly related to <code>levels</code> and will thus
have the same structure. <code>levels</code> contains the information
regarding the final data set. <code>orig_lvls</code> contains the same
structure of information, but regarding the data set it was trained on
before the steps take effect. This information is in many ways similar
to what is found in <code>ptype</code>.</p>
</div>
<div class="section level2">
<h2 id="fit_times">fit_times<a class="anchor" aria-label="anchor" href="#fit_times"></a>
</h2>
<p><em>Appears only in prepped recipes</em></p>
<p>A tibble containing two columns <code>stage_id</code> and
<code>elapsed</code>. It will contain 2 rows for every <code>step</code>
or <code>check</code> contained in the recipe.</p>
<ul>
<li>
<code>stage_id</code> A character vector on the format
<code>{stage}.{name}_{id}</code> where <code>{stage}</code> can be
either <code>prep</code> or <code>bake</code>, <code>name</code> will be
the name of the step and <code>id</code> its id element.</li>
<li>
<code>elapsed</code> A double, a calculation done with
<code><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time()</a></code> to estimate how long each step took to
apply.</li>
</ul>
<p>This element is used by <code><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_fit_time()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="last_term_info">last_term_info<a class="anchor" aria-label="anchor" href="#last_term_info"></a>
</h2>
<p><em>Appears only in prepped recipes</em></p>
<p>A grouped tibble, this will look similar to <code>var_info</code> and
<code>term_info</code>. The main difference is that there is one row per
variable in the data. Variables with multiple roles don’t have different
rows and instead have them all listed in the list element of `role.</p>
<ul>
<li>
<code>variable</code> is a character vector of variable names.</li>
<li>
<code>type</code> is a list column of character vectors.</li>
<li>
<code>role</code> is a list column of character vectors.</li>
<li>
<code>source</code> is a character vector. It can contain 2 values
<code>"original"</code> and <code>"derived"</code>.</li>
<li>
<code>number</code> is an integer corresponding to the last step
where that variable was available.</li>
<li>
<code>skip</code> is a logical corresponding to the value of
<code>skip</code> in the last step where that variable was
available.</li>
</ul>
<p>This data set is used In case a variable was removed, and that
removal step used <code>skip = TRUE</code>, we need to retain its record
so that selectors can be properly used with <code>bake</code>. This is
important for skipped steps which might have resulted in columns not
being added/removed in the test set.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, Emil Hvitfeldt, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
